<!--
    Authors: Quentin Guenther, Jen Shin, Bessy Torres-Miller, Kianna Dyck
    Date: 04/10/2018
    Name of File: view-post.html
    Purpose: This page displays a post of a product idea.
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Home Page</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" type="text/css" media="screen" href="{{ @BASE }}/views/css/bootstrap.min.css" />

    <!-- Quill -->
    <link href="//cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <link href="//cdn.quilljs.com/1.3.6/quill.bubble.css" rel="stylesheet">

    <!-- FontAwesome -->
    <link rel="stylesheet"
          href="https://use.fontawesome.com/releases/v5.0.13/css/all.css"
          integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp"
          crossorigin="anonymous">

    <!-- External Styles -->
    <link rel="stylesheet" type="text/css" href="{{ @BASE }}/views/css/styles.css" />
    <link rel="stylesheet" type="text/css" href="{{ @BASE }}/views/css/view-post-styles.css" />
</head>
<body>
    <!-- Navigation Menu -->
    <include href="views/html/components/nav.html" />

    <!-- User Content -->
    <div class="container mt-2">
        <h1 class="mb-4">{{ @title }}</h1>
        <div class="row">
            <div class="col-6 mb-0">
                <h6 class="mb-0">Total Votes: <span id="count">{{ @postVotes }}</span></h6>
                <p class="mb-0">
                    <span id="vote">Vote
                    <check if="{{isset (@hasAlreadyVoted) }}">
                        <true><i class="fas fa-thumbs-up clicked"></i></true>
                        <false><i class="fas fa-thumbs-up"></i></false>
                    </check>
                    </span>
                </p>
            </div>
            <repeat group="{{ @postsVersions }}" value= "{{ @post }}">
                <check if =" {{ @PARAMS['postId'] == @post['postId'] && @post['isActive'] == 1 }}">

                <div class="col-6 mb-0 text-right">
                    <button class="btn bg-green-river-green" onclick="toggleEditor();">Edit</button>
                </div>
                </check>
            </repeat>
        </div>

        <!-- Hidden input containing votes user has -->
        <input type="hidden" id="totalUserVotes" value="{{ @availableVotes }}">
        <!-- Hidden input for userId -->
        <input type="hidden" id="userId" value="{{ @userId }}">

        <div class="row">
            <div class="col">
                <div id="reader-container" class="ql-reader" rel="quill-reader"></div>
                <!-- Hidden input containing value of param, postId -->
                <input type="hidden" id="postId" value="{{ @PARAMS['postId'] }}">
            </div>
        </div>
        <form id="idea-form" method="post" action="" style="display: none">
            <div>
                <p><strong>Note:</strong><br>Your post must be less than 7mb <em>total</em>. Below is a progress bar to help you gauge the size of your post. If you find your post going over the limit, try resizing and/or compressing your images.</p>
            </div>
            <div class="progress">
                <div class="progress-bar bg-success" role="progressbar" style="width: 0" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
            <br>

            <p class="text-danger">{{ @contentErr}}</p>

            <div class="form-group">
                <input type = "hidden" name = "new-post">
                <div id="editor-container" rel="quill-editor"  tabindex="2"></div>
            </div>

            <input type="submit" id = "submit"  name = "submit" class="btn bg-green-river-green" value="Add Post" />
        </form>
        <div class = "m-5 list-group">
        <check if = "{{ sizeOf(@postsVersions) }}">
            <true><h3>Post Versions</h3>
            <repeat group="{{ @postsVersions }}" value= "{{ @post }}">
                <check if =" {{@PARAMS['postId']}} != {{@post['postId']}}">

                    <a href = "{{ @post['postId']}}"
                       class="text-primary list-group-item list-group-item-action"><b>Last Modified:</b> {{ @post['time' ] }} <b>by</b> {{ @post['member'] }} </a>

                </check>
            </repeat>
            </true>
            <false><p>Array not set properly.</p></false>
        </check>
        </div>
    </div>

    <!-- jQuery Library -->
    <script src="{{ @BASE }}/views/js/jquery.min.js"></script>
    <!-- Bootstrap -->
    <script src="{{ @BASE }}/views/js/bootstrap.min.js"></script>
    <!-- Quill js -->
    <script src="//cdn.quilljs.com/1.3.6/quill.min.js"></script>
    <!-- External js -->
    <script src="{{ @BASE }}/views/js/post.js"></script>
    <script src="{{ @BASE }}/views/js/view-post.js"></script>
    <script src="{{ @BASE }}/views/js/create-post.js"></script>

    <script>
        function toggleEditor() {
            $( "#reader-container" ).toggle();
            $( "#idea-form" ).toggle();
        }
    </script>

</body>
</html>